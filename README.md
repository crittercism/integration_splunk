Notes on the Crittercism Splunk App
===================================
Version 1.3

Rationale
---------
     Make Crittercism mobile app performance data accessable and useful to Splunk users and provide end to end visibility into performance issues.

Design goals
------------
    - Where possible, flatten Crittercism API data to easy to Splunk KV pairs
    - Try to make few assumptions on how the data is coming in and utilize guidance from published API specs
    - Provide sample dashboards for drilldown and search 
    
Operational notes
-----------------
    - all data obtained in placed into a special Splunk index named "crittercism".  To
    query the data directly, you must include "index=crittercism" in your search.
    
Installation and Configuration
------------------------------
This app is installed via Splunkbase or Splunk's standard app install process.
For multi-tiered Splunk installations, the app should be installed on all search heads and
either one indexer or one persistant forwarder.  On the search heads, disable the running
of the critterget.py scripted input in Settings->DataInputs->Scripts. 
    

    
MessageTypes
============
This app relies on a script called CritterGet.py to connect to the Crittercism service
and return data in a Splunk edible format.  Every 'event' generated by this app has an 
associated MessageType.  


- AppSummary
    Basic data from the summary endpoint.  appName, type, latency
    
- CrashSummary
    Basic information about a crash.  What app caused it, its status, when it last 
    occurred.  NOTE - a CrashSummary event will be generated when a crash occurs 
    since the previous time critterget.py has been run.  IF a crash has occurred, 
    all other crash related events also get generated (details, counts, etc). To 
    effectively use this data, 'dedup' on hash.  For instance, to see a quick
    summary of all crashes, run the following Splunk command:
        index=crittercism MessageType=CrashSummary | dedup hash 
        | table appName, lastOccurred, name, status, sessionCount

- CrittercismError
    Tracks errors produced by the critterget.py script.  Useful for tracking down errors
    to a modified script and permission issues.
  
- DailyServiceErrorRates
    Event created every time the script executes. To get the most recent rates, use a
    search similar to:
        index=crittercism sourcetype=crittercism MessageType=DailyServiceErrorRates appName=<Your App Name> | head 1
     Returns tuples of data returned by the endpoint.  Table or graph these values with 
     a mv expression such as:
         | head 1| rex "\((?<serv>\".*?\")\,(?<val>\d+\.\d+)" max_match=30 
         | eval fields=mvzip(serv,val) | mvexpand fields 
         | rex field=fields "\"(?<SERVICE>.*?)\",(?<RATE>\d+\.\d{2})"
         |sort -RATE |  table SERVICE,RATE 

- DailyAppLoads
    Event created every time the script executes. One event created for each app.
    To get the most recent rates, use a search similar to:
        sourcetype=crittercism appName=<Your App Name> MessageType=DailyAppLoads | head 1

- DailyCrashes
    Event created every time the script executes. One event created for each app.
    To get the most recent rates, use a search similar to:
        index=crittercism sourcetype=crittercism appName=<Your App Name> MessageType=DailyCrashes | head 1

- CrashCounts
    Event created every time the script executes. One event created for each app.
    To get the most recent rates, use a search similar to:
        sourcetype=crittercism appName=<Your App Name> MessageType=CrashCounts | head 1
    Returns tuples of data returned by the endpoint.  Table or graph these values with 
     a mv expression or the `detuple` macro.

- DailyCrashesByOS
    Event created every time the script executes. One event created for each app.
    To get the most recent rates, use a search similar to:
        index=crittercism sourcetype=crittercism appName=<Your App Name> MessageType=DailyCrashesByOS | head 1
    Returns tuples of data returned by the endpoint.  Table or graph these values with 
     a mv expression or the `detuple` macro.

- DailyAppLoadsByDevice
    Event created every time the script executes. One event created for each app.
    To get the most recent load counts, use a search similar to:
        sourcetype=crittercism appName=<Your App Name> MessageType=DailyAppLoadsByDevice | head 1
    Returns tuples of data returned by the endpoint.  Table or graph these values with 
     a mv expression or the `detuple` macro.

- CrashDetail
    Event is created ONLY if a crash for has occurred since the last script run.  Returns
    multiple data points regarding a crash (reason,status,hash,first and last occurrence)
    To get the most recent load counts, use a search similar to:
        index=crittercism sourcetype=crittercism appName=<Your App Name> MessageType=CrashDetail| head 1
    
- CrashDetailUniqueSessionCountsByVersion
    Event is created ONLY if a crash for has occurred since the last script run. One
    event for each crash hash created.  Returns data in 'json data dump' format.  Use
    mv commands or json_data_mv macro turn into splunk fields 


- CrashDetailSymbolizedStacktrace
    Event is created ONLY if a crash for has occurred since the last script run. One
    event for each crash hash created.  Returns data in 'json data list' format.

- CrashDetailStacktrace
    Event is created ONLY if a crash for has occurred since the last script run. One
    event for each crash hash created.  Returns data in 'json data list' format. This
    event is probably better left as a single item for searchability, but can be 
    broken into mv 'lines' for pretty display.

- CrashDetailSessionCountsByVersion
    Event is created ONLY if a crash for has occurred since the last script run. One
    event for each crash hash created.  Returns data in 'json data dump' format.  Use
    mv commands or json_data_mv macro turn into splunk fields 


- CrashDetailDailyOccurrencesByVersion
    Event is created ONLY if a crash for has occurred since the last script run. One
    event for each crash hash created.  Returns data in 'json data dump' format.
    
- CrashDetailBreadcrumbs

    Events created for each tuple of (os,appversion,device) for a registered crash.
    Provides breadcrumbs from the crashed, previous, and current session of the app.

- CrashDiagsAffectedUser
    Events created only if a crash has occurred since last run, and then creates one
    event for each user affected.  

- CrashDiagsGeo
    Events created only if a crash has occurred since last run, and then creates one
    event for each cartesian pair (city, lat, lon) where crashes were reported.
    
- Appload
    Events created once per run.  Returns the rolling number of 'HourlyAppLoads' per
    application
     
- CrashDiagsDiscrete
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks the number of crashes reported for various data points (model, locale, 
    carrier, etc.)  See the discrete_vars macro for information on breaking this
    event into usable data.
    
- CrashDiagsContinuous
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks the rolling data concerning memory and disk usage.

- CrashDiagsContBar
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks grouped rolling data re: memory usage
    
- CrashDiagsAffectedVersions
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks crashes per app version.

- DailyVolumeByDevice
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks volume per device.
- DailyVolumeByOS       
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks volume per OS version.
- CrashesByDevice
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks crashes per Device.
- CrashPerByDevice
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks percent of crashes per device.
- ApploadsByOs
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks app loads by OS.
- CrashPerByOs
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks crash percentage per OS.
- VolumeByAppVersion
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks volume per app version.
- CrashPerByAppVersion
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks crash percentage by app version.
- CrashByAppVersion
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks crashes per app version.
- LoadsByAppVersion
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks loads per app version.
- DauByAppVersion
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks dau per app version.
- ApploadsByDevice
    One event per crash 'hash' assuming a crash has occurred since the last run.
    Tracks app loads by device 





Macros
------

Several macros are provided with the app and used within the dashboard reports.
These macros as as follows:

- clean_ctrl
Removes control characters (\t \n) from a field.
some spl with field foo | `clean_crtl(foo)` | foo is now stripped

- clean_json
Removes unicode and json bracket characters ([,],[u',]]) from a field.
some spl with field foo | `clean_json(foo)` | foo is now stripped

- detuple
Takes a crittercism event with a tupled DATA component and converts to mv fields
    index=crittercism DailyCrashesByOS | head 1 | `detuple` | table SERVICE,RATE

- json_data_mv
Takes a crittercism event in json data dump firm (tuples within {}'s) and
converts to mv fields suitable for tables, searches, charts
    index=crittercism CrashDetailUniqueSessionCountsByVersion | head 1|`json_data_mv`| table VAR,VAL
    
- discrete_vars
Turns a CrashDiagsDiscrete message into a series of events containing
the tuple (VAR,VAL) where VAR is the name of the data point, and VAL is the number
of entries recorded.  For instance, to view overall carrier information for a given
crash, try:
    index=crittercism sourcetype=crittercism MessageType=CrashDiagsDiscrete "hash=<HASH ID>" | head 1
    | `discrete_vars`| search VAR=carrier* | chart list(VAL) AS Percentage by VAR
    
Useful Shortcuts
----------------

Add an appName to an event that only has a 'hash' 
    (search here) join[ search index=crittercism sourcetype=crittercism MessageType=CrashSummary |fields appName]
